<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brandie AI Assistant - Chat Support</title>
  <meta name="description" content="Chat with Brandie AI Assistant for instant answers about services, pricing, and more.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #ffffff;
      --bg-secondary: #f5f5f5;
      --text: #141414;
      --text-muted: #666666;
      --primary: #b91c1c;
      --primary-light: rgba(185, 28, 28, 0.1);
      --border: #e5e5e5;
      --card-bg: #fafafa;
    }

    .dark {
      --bg: #0b0b0b;
      --bg-secondary: #0f0f10;
      --text: #f5f5f5;
      --text-muted: #a8a8a8;
      --primary: #ef4444;
      --primary-light: rgba(239, 68, 68, 0.12);
      --border: rgba(255,255,255,0.06);
      --card-bg: #0f0f10;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* Header */
    header {
      padding: 24px 0;
      border-bottom: 1px solid var(--border);
      background: var(--bg);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.25rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-dot {
      width: 8px;
      height: 8px;
      background: var(--primary);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .theme-toggle {
      width: 40px;
      height: 40px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--card-bg);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .theme-toggle:hover {
      background: var(--bg-secondary);
    }

    .theme-toggle svg {
      width: 20px;
      height: 20px;
      stroke: var(--text);
    }

    .sun-icon { display: block; }
    .moon-icon { display: none; }
    .dark .sun-icon { display: none; }
    .dark .moon-icon { display: block; }

    /* Main Chat Container */
    .chat-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin: 40px 0;
      align-items: start;
    }

    @media (max-width: 968px) {
      .chat-container {
        grid-template-columns: 1fr;
        gap: 24px;
      }
    }

    /* Chat Box */
    .chat-box {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      height: 600px;
      overflow: hidden;
    }

    .chat-header {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-secondary);
    }

    .chat-header h2 {
      font-size: 1.125rem;
      margin-bottom: 4px;
    }

    .chat-header p {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .message {
      display: flex;
      gap: 8px;
      animation: slide-in 0.3s ease-out;
    }

    @keyframes slide-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.user {
      justify-content: flex-end;
    }

    .message-bubble {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 12px;
      word-wrap: break-word;
    }

    .message.bot .message-bubble {
      background: var(--bg-secondary);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .message.user .message-bubble {
      background: var(--primary);
      color: white;
    }

    .chat-input-area {
      padding: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 8px;
    }

    #chatInput {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.95rem;
    }

    #chatInput:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-light);
    }

    .chat-send-btn {
      padding: 10px 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .chat-send-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* FAQ Section */
    .faq-section h2 {
      font-size: 1.5rem;
      margin-bottom: 24px;
    }

    .faq-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .faq-item {
      padding: 14px 16px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .faq-item:hover {
      background: var(--bg-secondary);
      transform: translateX(4px);
    }

    .faq-item-question {
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .faq-item-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
    }

    /* WhatsApp CTA */
    .whatsapp-cta {
      background: var(--primary);
      color: white;
      padding: 20px 16px;
      border-radius: 12px;
      text-align: center;
      margin-top: 24px;
    }

    .whatsapp-cta h3 {
      margin-bottom: 8px;
    }

    .whatsapp-cta p {
      font-size: 0.95rem;
      opacity: 0.95;
      margin-bottom: 12px;
    }

    .whatsapp-cta a {
      display: inline-block;
      background: white;
      color: var(--primary);
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
    }

    .whatsapp-cta a:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* Loading indicator */
    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 8px;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-muted);
      animation: bounce 1.4s infinite;
    }

    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
      0%, 80%, 100% { opacity: 0.4; transform: translateY(0); }
      40% { opacity: 1; transform: translateY(-8px); }
    }

    footer {
      text-align: center;
      padding: 24px 0;
      color: var(--text-muted);
      font-size: 0.875rem;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }

    a {
      color: var(--primary);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
    /* Respect users' reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      .typing-indicator,
      .typing-dot,
      .message,
      .message-bubble,
      .animate-on-scroll,
      .chat-messages,
      .chat-box,
      .chat-send-btn {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>
<body>
  <style>
    :root { --focus-outline: 3px solid rgba(185,28,28,0.95); }
    a:focus-visible, button:focus-visible, .btn:focus-visible, #chatInput:focus-visible {
      outline: var(--focus-outline);
      outline-offset: 3px;
      border-radius: 8px;
    }
  </style>
  <script>
    (function() {
      try {
        const saved = localStorage.getItem('theme');
        if (saved === 'light') {
          document.documentElement.classList.remove('dark');
        } else if (saved === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.add('dark');
        }
      } catch (e) {}
    })();
  </script>

  <!-- Header -->
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          Brandie AI Assistant
          <span class="logo-dot"></span>
        </div>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
          <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
          <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <div class="chat-container">
      <!-- Chat Box -->
      <div class="chat-box">
        <div class="chat-header">
          <h2>Brandie AI</h2>
          <p>Ask me anything about services, pricing & more</p>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="message bot">
            <div class="message-bubble">
              ðŸ‘‹ Hey! I'm Brandie AI Assistant. How can I help you today? Feel free to ask about services, pricing, processes, or anything else!
            </div>
          </div>
        </div>
        <div class="chat-input-area">
          <input 
            type="text" 
            id="chatInput" 
            placeholder="Type your question..." 
            autocomplete="off"
          >
          <button class="chat-send-btn" id="chatSendBtn">Send</button>
        </div>
      </div>

      <!-- FAQ & CTA -->
      <div class="faq-section">
        <h2>Popular Questions</h2>
        <div class="faq-list" id="faqList"></div>

        <div class="whatsapp-cta">
          <h3>Need more help?</h3>
          <p>Can't find the answer? Chat directly with Brandie on WhatsApp.</p>
          <a href="https://wa.me/2348112788128" target="_blank" rel="noopener noreferrer">
            ðŸ’¬ Chat on WhatsApp
          </a>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <p>Â© 2025 Brandie Creative. <a href="/">Back to Portfolio</a></p>
  </footer>

  <script>
    // FAQ Data (synced from index page)
    const faqData = [
      {
        id: 1,
        question: "How long does a website take?",
        answer: "Most sites take 3â€“6 weeks depending on scope and revisions."
      },
      {
        id: 2,
        question: "Do you provide copy?",
        answer: "Yes â€” clear messaging is included in website projects."
      },
      {
        id: 3,
        question: "What if I need help after launch?",
        answer: "I offer post-launch optimization and retainers â€” ask for options."
      },
      // Additional helpful FAQs
      {
        id: 4,
        question: "What services do you offer?",
        answer: "Website Development, Motion Graphics & Promo Videos, and Messaging & Copywriting."
      },
      {
        id: 5,
        question: "How do I get started?",
        answer: "Email brandiecreative@gmail.com, or chat on WhatsApp for a quick discussion."
      }
    ];
    
    // Knowledge base extracted from portfolio content (services, process, stats)
    const kbData = [
      { id: 'kb-hero', title: 'Brandie Creative overview', content: "Website developer, motion graphics designer, and creative director. Helping service professionals look premium and convert more online." },
      { id: 'kb-services-website', title: 'Website Development', content: 'Modern, fast, and conversion-driven websites that help your business stand out and get results.' },
      { id: 'kb-services-motion', title: 'Motion Graphics & Promo Videos', content: 'Eye-catching visuals that promote your brand, explain your product, or boost engagement on social media.' },
      { id: 'kb-services-messaging', title: 'Messaging & Copy', content: 'Benefit-led messaging, headlines, and service pages that make your offer clear and compelling.' },
      { id: 'kb-process', title: 'Working process', content: 'Share goals & outcomes â†’ Agree strategy â†’ Design & build â†’ Launch â†’ Optimize. Delivered in 3â€“6 weeks; includes messaging & two revisions.' },
      { id: 'kb-stats', title: 'Results & metrics', content: '50+ Projects Completed, 30+ Happy Clients, 200% Avg Traffic Increase, 24h Response Time.' }
    ];

    // Simple conversation memory (last N turns)
    const convoMemory = {
      user: [],
      bot: [],
      maxTurns: 6
    };

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;

    themeToggle.addEventListener('click', () => {
      html.classList.toggle('dark');
      localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
    });

    // Chat functionality
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const chatSendBtn = document.getElementById('chatSendBtn');
    const faqList = document.getElementById('faqList');

    // Populate FAQ list
    function populateFAQ() {
      faqList.innerHTML = faqData.map(faq => `
        <div class="faq-item" onclick="sendMessage('${faq.question.replace(/'/g, "\\'")}')">
          <div class="faq-item-question">
            <span class="faq-item-icon">?</span>
            ${faq.question}
          </div>
        </div>
      `).join('');
    }

    // Utilities for smarter matching
    const STOPWORDS = new Set(['the','is','in','at','which','on','a','an','and','or','for','to','of','with','how','what','do','i','you','my','me','are','be']);

    function tokenize(text) {
      return (text || '')
        .toLowerCase()
        .replace(/[^^\w\s]/g, ' ')
        .split(/\s+/)
        .filter(Boolean)
        .filter(w => !STOPWORDS.has(w));
    }

    function jaccard(a, b) {
      const A = new Set(a);
      const B = new Set(b);
      const inter = new Set([...A].filter(x => B.has(x))).size;
      const uni = new Set([...A, ...B]).size;
      return uni === 0 ? 0 : inter / uni;
    }

    function levenshtein(a, b) {
      if (!a.length) return b.length;
      if (!b.length) return a.length;
      const matrix = Array.from({length: b.length + 1}, (_, i) => Array(a.length + 1).fill(0));
      for (let i = 0; i <= b.length; i++) matrix[i][0] = i;
      for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          const cost = a[j-1] === b[i-1] ? 0 : 1;
          matrix[i][j] = Math.min(
            matrix[i-1][j] + 1,
            matrix[i][j-1] + 1,
            matrix[i-1][j-1] + cost
          );
        }
      }
      return matrix[b.length][a.length];
    }

    // synonyms to normalize user input
    const SYNONYMS = {
      website: ['site','website','websites','web'],
      motion: ['motion','animation','video','promo','promo video'],
      pricing: ['price','cost','pricing','budget','afford'],
      support: ['support','maintenance','ongoing','help']
    };

    function expandTokens(tokens) {
      const out = new Set(tokens);
      tokens.forEach(t => {
        for (const [key, arr] of Object.entries(SYNONYMS)) {
          if (arr.includes(t)) out.add(key);
        }
      });
      return Array.from(out);
    }

    // Find matching answer using combined heuristics (FAQ + KB + convo memory)
    function findAnswer(userMessage) {
      const userTokens = expandTokens(tokenize(userMessage));
      if (userTokens.length === 0) return null;

      let best = {score: 0, type: null, item: null};

      // Score against FAQ entries (higher priority)
      faqData.forEach(faq => {
        const faqTokens = expandTokens(tokenize(faq.question + ' ' + faq.answer));
        const jac = jaccard(userTokens, faqTokens);

        // short queries: check levenshtein distance with question
        const dist = levenshtein(userMessage.toLowerCase().slice(0,80), faq.question.toLowerCase().slice(0,80));
        const normDist = 1 - dist / Math.max(faq.question.length, userMessage.length, 1);

        // combined score and small boost from recent convo topic
        let score = Math.max(jac, normDist * 0.8);
        if (convoMemory.user.length) {
          const last = convoMemory.user[convoMemory.user.length - 1];
          const lastTokens = expandTokens(tokenize(last));
          const overlap = jaccard(faqTokens, lastTokens);
          if (overlap > 0.18) score += 0.08;
        }

        if (score > best.score) best = {score, type: 'faq', item: faq};
      });

      // Score against KB entries (lower weight but useful for supporting content)
      kbData.forEach(kb => {
        const kbTokens = expandTokens(tokenize(kb.title + ' ' + kb.content));
        const jac = jaccard(userTokens, kbTokens);
        const dist = levenshtein(userMessage.toLowerCase().slice(0,80), kb.title.toLowerCase().slice(0,80));
        const normDist = 1 - dist / Math.max(kb.title.length, userMessage.length, 1);

        let score = Math.max(jac * 0.95, normDist * 0.7);
        if (convoMemory.user.length) {
          const lastTokens = expandTokens(tokenize(convoMemory.user[convoMemory.user.length - 1]));
          const overlap = jaccard(kbTokens, lastTokens);
          if (overlap > 0.18) score += 0.06;
        }

        if (score > best.score) best = {score, type: 'kb', item: kb};
      });

      // Return best match with type-aware thresholds
      if (best.type === 'faq' && best.score >= 0.18) return best.item.answer;
      if (best.type === 'kb' && best.score >= 0.15) return best.item.content;
      return null;
    }

    // Add message to chat
    function addMessage(text, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
      
      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      bubble.textContent = text;
      
      messageDiv.appendChild(bubble);
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Show typing indicator
    function showTypingIndicator() {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message bot';
      messageDiv.id = 'typingIndicator';
      
      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      bubble.innerHTML = '<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
      
      messageDiv.appendChild(bubble);
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Remove typing indicator
    function removeTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) indicator.remove();
    }

    // Send message
    function sendMessage(message = null) {
      const userMessage = message || chatInput.value.trim();
      
      if (!userMessage) return;

      addMessage(userMessage, true);
      chatInput.value = '';

      // store user turn in memory
      convoMemory.user.push(userMessage);
      if (convoMemory.user.length > convoMemory.maxTurns) convoMemory.user.shift();

      showTypingIndicator();

      // first try the local KB
      const localAnswer = findAnswer(userMessage);

      if (localAnswer) {
        // quick local reply
        setTimeout(() => {
          removeTypingIndicator();
          addMessage(localAnswer, false);
          convoMemory.bot.push(localAnswer);
          if (convoMemory.bot.length > convoMemory.maxTurns) convoMemory.bot.shift();
        }, 400);
        return;
      }

      // if no local answer, attempt AI endpoint (/api/chat)
      (async () => {
        try {
          const resp = await fetch('/.netlify/functions/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userMessage, history: [...convoMemory.user.map(u=>({role:'user',content:u})), ...convoMemory.bot.map(b=>({role:'assistant',content:b}))] })
          });

          if (!resp.ok) throw new Error('AI endpoint error');
          const data = await resp.json();
          removeTypingIndicator();
          if (data && data.reply) {
            addMessage(data.reply, false);
            convoMemory.bot.push(data.reply);
            if (convoMemory.bot.length > convoMemory.maxTurns) convoMemory.bot.shift();
          } else {
            throw new Error('No reply from AI');
          }
        } catch (err) {
          // fallback to friendly default when AI fails
          removeTypingIndicator();
          const defaultResponse = `I'm not sure about that specific question. However, I'd love to help! ðŸš€\n\nFeel free to ask about my services, pricing, or processes. Or chat directly with me on WhatsApp for a personalized answer!`;
          addMessage(defaultResponse, false);
          convoMemory.bot.push(defaultResponse);
          if (convoMemory.bot.length > convoMemory.maxTurns) convoMemory.bot.shift();
        }
      })();
    }

    // Event listeners
    chatSendBtn.addEventListener('click', () => sendMessage());
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // Initialize FAQ
    populateFAQ();
  </script>
</body>
</html>
